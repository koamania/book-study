# 객체, 설계
## 소프트웨어 모듈의 3가지 목적
1. 실행 중에 제대로 동작해야 한다.
2. 변경을 위해 존재해야 한다.
3. 코드를 읽는 사람과 의사소통하는 것이다.

## bad 코드의 문제점
도둑놈도 아니고 소극장이 관람객의 가방을 뒤져서 돈을 가져가고 티켓을 소매넣기 하고 있다.  
판매원 입장에서도 문제는 소극장이 허락도 없이 매표소에 보관 중인 티켓과 현금에 접근한다.  
더 큰 문제는 이 모든 일을 소극장이 하고 있다는 점이다.

소극장이 공연을 해야지 무슨 금품 절도, 소매넣기 등 이상한 짓을 하는 걸까?

> 이해 가능한 코드란 그 동작이 예상에서 크게 벗어나지 않는 코드다.  

현실에서는 관람객이 직접 자신의 가방에서 초대장(돈)을 꺼내 판매원에게 건네고,  
판매원은 매표소에 있는 티켓을 직접 꺼내 관람객에게 건네고 관람객에게 초대장(돈)을 받아서 배표소에 보관한다.

> 우리의 상식과는 너무나도 다르게 동작하기 때문에 코드를 읽는 사람과 제대로 의사소통 할 수 없다.  
현실 예 : 아니 결제 모듈이 금액을 왜 바꾸는데 ㅡㅡ

여기서 문제점 또 한가지는 코드를 이해하기 위해서는 세부적인 내용들을 한꺼번에 기억하고 있어야 한다.(소극장이 돈을 훔쳐서 소매넣기하고... 등등등)

하지만 가장 심각한 문제는 Audience와 Ticket Seller를 변경할 경우 Theater도 함께 변경해야 한다는 점...

## 변경에 취약한 코드
예를 들어 관람객이 가방이 아닌 지갑만 갖고 있다하는 상황으로 바뀌게 되면?  
관람객이 현금이 아닌 카드로 결제를 하려고 한다면?

Audience의 Bag에 직접 접근하는 Theater의 enter 메서드를 수정해야한다.
Theater는 Audience의 지나치게 세부적인 사실에 의존해서 동작한다.  
세부적인 사실이 변경 될 경우 의존하는 모든 부분이 변경되어야 한다.

> 객체 사이의 의존성(Dependency)에 대한 문제를 생각해 볼 수 있다.
의존성은 변경에 대한 영향을 암시한다.

## 리팩토링
해결방법은 의외로 간단하다.
Theater가 Audience와 TicketSeller의 지나치게 세부적인 항복을 알지못하도록 정보를 차단하면 된다.
개념적이나 물리적으로 객체 네부의 세부적인 사항을 감추는 것을 캡슐화(encapsulation)이라고 한다.
> 캡슐화의 목적은 변경하기 쉬운 객체를 만드는 것이다.
의도치 않은 곳에서 값을 변경함으로써 수정해야 하는 범위가 늘어나고 이는 코드를 이해하는데 있어서도 큰 어려움을 준다.

객체를 인터페이스와 구현으로 나누고 인터페이스만을 공개하는 것은 객체 사이의 결합도를 낮추고 변경하기 쉬운 코드를 작성하기 위해 따라야하는 가장 기본적인 설계 원칙이다.

리팩토링 후에는 각 클래스들이 외부로 공개되어야 할 정보(혹은 동작)에 명확해졌고, 이해하기 쉬운 코드가 되었다.
복잡한 의존성을 개선하기 위해 다른 클래스로부터 정보를 은닉하고 전달된 메시지를 바탕으로 자신의 값을 제어하게 되면서 결론적으로 결합도와 응집도가 상승하게 되었다.

> 객체 내부의 상태를 캡슐화하고 객체 간에는 오직 메시지를 통해서만 상호작용 하도록 만드는 것이다.

## 절차지향과 객체지향
BAD 예제에서 Theater의 역할은 모든 데이터를 제어하는 Process로 역할 하고 있다.  
Audience, TicketSeller, Bag, TicketOffice 모두 스스로 값을 제어하는 형태가 아닌 Theater에 값을 제공만 하는 Data다.  
이런 절차지향 프로그래밍 우리가 예상하기 힘든 동작 흐름을 가지게 되고 데이터 변경으로 인한 영향을 지역적으로 고립시키기 어렵게 만든다.

Refactoring 예제에서와 같이 각 클래스가 자신의 데이터를 스스로 제어하고 독립적인 Process를 가지도록 프로그래밍하는 방식을 객체지향(OOP)라고 한다.

> 객체지향 코드는 자신의 문제를 스스로 처리해야 한다는 우리의 예상을 만족시켜주기 떄문에 이해하기 쉽고,  
객체 내부의 변경이 객체 외부에 파급되지 않도록 제어할 수 있기 때문에 변경하기가 수월하다.

## 좋은 설계란
오늘 완성해야 하는 기능을 구현하는 코드를 짜야 하는 동시에 내일 쉽게 변경할 수 있는 코드를 짜야 한다.
데이터와 프로세스를 응집시키고 적절히 외부에 공개해서 객체들간의 상호작용을 직관적으로 표현해야 이해하기 쉽고, 변경에는 유연한 코드를 작성할 수 있다.   